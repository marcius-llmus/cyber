<div class="p-6 overflow-y-auto flex-1 modal-scroll-content">
    <div class="space-y-6">
        <div>
            <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">LLM Configuration</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Coding LLM</label>
                    <select
                        name="coding_llm_settings_id"
                        class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm"
                        hx-get="/settings/llm-dependent-fields"
                        hx-trigger="change"
                        hx-target="#llm-dependent-fields"
                        hx-swap="outerHTML">
                        {% for option in llm_options %}
                            <option value="{{ option.id }}" {% if current_coder.id == option.id %}selected{% endif %}>
                                {{ option.visual_name }} - {{ option.provider }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div id="llm-dependent-fields">
                    {% with provider=current_coder.provider.value, api_key=coding_llm_masked_api_key, current_coder=current_coder %}
                        {% include "settings/partials/llm_dependent_fields.html" %}
                    {% endwith %}
                </div>
            </div>
        </div>

        <div>
            <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Model Parameters</h3>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Temperature</label>
                    <input type="number" name="coding_llm_temperature" step="0.1" min="0" max="1" value="{{ settings.coding_llm_temperature }}" class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Max History</label>
                    <input type="number" name="max_history_length" value="{{ settings.max_history_length }}" class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Context Window</label>
                    <input type="number" name="coding_llm_settings.context_window" value="{{ current_coder.context_window }}" class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">AST Token Limit</label>
                    <input type="number" name="ast_token_limit" value="{{ settings.ast_token_limit }}" class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Grep Token Limit</label>
                    <input type="number" name="grep_token_limit" value="{{ settings.grep_token_limit }}" class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm">
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Patch processor</label>
                    <select
                        name="diff_patch_processor_type"
                        class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm">
                        <option value="UDIFF_LLM" {% if settings.diff_patch_processor_type.value == "UDIFF_LLM" %}selected{% endif %}>
                            Unified Diff (LLM GPT-4.1 Mini)
                        </option>
                        <option value="CODEX_APPLY" {% if settings.diff_patch_processor_type.value == "CODEX_APPLY" %}selected{% endif %}>
                            Codex Apply
                        </option>
                    </select>
                </div>
                <div class="col-span-2 pt-2">
                     <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="diff_patches_auto_open" value="true" {% if settings.diff_patches_auto_open %}checked{% endif %} class="form-checkbox bg-dark-lighter border-dark-light rounded text-primary focus:ring-0">
                        <span class="text-sm font-medium text-gray-300">Auto-open Diffs</span>
                    </label>
                </div>
                <div class="col-span-2">
                     <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" name="diff_patches_auto_apply" value="true" checked disabled class="form-checkbox bg-dark-lighter border-dark-light rounded text-primary focus:ring-0 opacity-60">
                        <span class="text-sm font-medium text-gray-300">
                            Auto-apply Diffs
                        </span>
                     </label>
                </div>
            </div>
        </div>
        <div>
            <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">RepoMap Configuration</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">RepoMap Mode</label>
                    <select
                        name="repomap_mode"
                        class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm">
                        <option value="AUTO" {% if settings.repomap_mode.value == 'AUTO' %}selected{% endif %}>Auto (RepoMap)</option>
                        <option value="TREE" {% if settings.repomap_mode.value == 'TREE' %}selected{% endif %}>File Tree Only</option>
                        <option value="MANUAL" {% if settings.repomap_mode.value == 'MANUAL' %}selected{% endif %}>Manual (Tool Explorer)</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Auto: Full map + snippets. Tree: Full file list only. Manual: Top-level only (Agent uses tools).</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">RepoMap Ignore Patterns</label>
                    <textarea
                        name="repomap_ignore_patterns"
                        rows="4"
                        class="w-full bg-dark-lighter border border-dark-light rounded-lg px-3 py-2 text-sm font-mono"
                        placeholder="*.log&#10;temp/">{{ settings.repomap_ignore_patterns or '' }}</textarea>
                    <p class="text-xs text-gray-500 mt-1">
                        Glob patterns to exclude from RepoMap (one per line). This only affects RepoMap generation;
                        excluded files can still be searched/read by tools and can still appear in the file tree or active context.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
