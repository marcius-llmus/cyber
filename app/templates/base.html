<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Llama Coding - AI Development Assistant</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/static/css/app.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js" integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx-ext-ws@2.0.4" integrity="sha384-1RwI/nvUSrMRuNj7hX1+27J8XDdCoSLf0EjEyF69nacuWyiJYoQ/j39RT1mSnd2G" crossorigin="anonymous"></script>
    <script src="/static/js/htmx-ext-form-json.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.15.1/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Highlight Theme Link (ID required for dynamic switching) -->
    <link id="highlight-theme-link" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': 'var(--color-primary)',
                        'primary-dark': 'var(--color-primary-dark)',
                        'primary-light': 'var(--color-primary-light)',
                        'dark': 'var(--color-dark)',
                        'dark-lighter': 'var(--color-dark-lighter)',
                        'dark-light': 'var(--color-dark-light)',
                        'dark-card': 'var(--color-dark-card)',
                        'dark-darker': '#000000'
                    }
                }
            }
        }
    </script>
    <script>
        // Initialize Markdown Parser
        const md = window.markdownit({
            html: true,
            linkify: true,
            breaks: true,
            typographer: true
        });
    </script>
    <style x-data x-text="`
        :root {
            --color-dark: ${$store.appearance.bgColor};
            --color-dark-lighter: ${$store.appearance.bgSecondaryColor};
            --color-dark-light: ${$store.appearance.bgLightColor};
            --color-dark-card: ${$store.appearance.bgCardColor};
            --color-text: ${$store.appearance.textColor};
            --color-primary: ${$store.appearance.primaryColor};
            --color-primary-dark: ${$store.appearance.primaryDarkColor};
            --color-primary-light: ${$store.appearance.primaryLightColor};
            --fs-ui: ${$store.appearance.uiFontSize}px;
            --fs-editor: ${$store.appearance.editorFontSize}px;
        }
        body { font-size: var(--fs-ui) !important; background-color: var(--color-dark) !important; color: var(--color-text) !important; }
        .text-gray-200, .text-gray-300, .text-gray-400 { color: var(--color-text) !important; }
        #message-list { font-size: var(--fs-editor) !important; }
        
        /* Adjust opacity for secondary text to keep hierarchy */
        .text-xs, .text-sm { opacity: 0.9; }
    `"></style>
</head>
<body class="bg-dark text-gray-200 h-screen flex" 
      hx-ext="ws" 
      ws-connect="/coder/ws/session/{{ session.id }}"
      x-data>
    
    <!-- Tailwind CSS Safelist -->
    <div class="hidden border-red-500 border-green-500 border-blue-500 border-yellow-500"></div>
    
    {% include "layout/sidebar.html" %}

    <main class="flex-1 flex overflow-hidden bg-dark">
        {% block content %}{% endblock %}

        {% include "layout/right_sidebar.html" %}
    </main>

    {% include "settings/settings_modal.html" %}
    {% include "settings/appearance_modal.html" %}
    {% include "projects/projects_modal.html" %}
    {% include "prompts/prompts_modal.html" %}
    {% include "history/history_modal.html" %}
    {% include "context/context_file_selection_modal.html" %}
    {% include "components/alerts/toast.html" %}
    <script src="/static/js/app.js"></script>
</body>
</html>