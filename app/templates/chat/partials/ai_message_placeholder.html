<div hx-swap-oob="beforeend:#message-list">
    <div class="flex items-start gap-3" id="ai-message-{{ turn_id }}">
        <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center flex-shrink-0">
            {% include "components/icons/ai_avatar.html" %}
        </div>
        <div class="bg-dark-card rounded-lg p-4 flex-1 min-w-0">
            <!-- Stream Container (Interleaved Text & Diffs) -->
            <div id="stream-container-{{ turn_id }}" class="flex flex-col gap-2 min-h-[20px]">
                <!-- Content will be streamed here -->
            </div>

            <!-- Status Indicator (Moved up) -->
            <div id="ai-status-{{ turn_id }}"></div>

            <!-- Tool Calls Container -->
            <div id="tool-calls-container-{{ turn_id }}" class="mt-4 border-t border-gray-700 pt-2 hidden">
                <details class="group">
                    <summary class="cursor-pointer text-xs font-mono text-gray-500 hover:text-gray-300 flex items-center gap-2 select-none outline-none py-1">
                        <i class="fas fa-terminal"></i>
                        <span>Tool Calls</span>
                        <span class="ml-auto group-open:rotate-180 transition-transform duration-200">
                            <i class="fas fa-chevron-down"></i>
                        </span>
                    </summary>
                    <div id="tool-calls-list-{{ turn_id }}" class="mt-2">
                    </div>
                </details>
            </div>

            <!-- Controls Container -->
            <div id="controls-{{ turn_id }}"></div>
        </div>
    </div>
</div>