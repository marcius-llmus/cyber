<div class="flex-1 overflow-y-auto p-4 pb-10 space-y-5 scroll-smooth break-words" id="message-list">
    <!-- System welcome message -->
    <div class="flex items-start gap-3" id="ai-message-system">
        <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center flex-shrink-0">
            {% include "components/icons/ai_avatar.html" %}
        </div>
        <div class="bg-dark-card rounded-lg p-4 flex-1 min-w-0">
            <div id="raw-system" class="hidden markdown-source">Hello! How can I assist you today?</div>
            <div id="rendered-system" class="prose prose-invert text-gray-300 w-full max-w-none break-words">
                <!-- JS will render -->
            </div>
        </div>
    </div>
    {% for message in messages %}
        {% if message.role.value == 'user' %}
        <div class="flex items-start gap-3" id="user-message-{{ message.id }}">
            <div class="bg-dark-card rounded-lg p-4 flex-1 min-w-0">
                <!-- User Markdown Rendering -->
                <div id="raw-user-{{ message.id }}" class="hidden markdown-source">{{ message.content }}</div>
                <div id="rendered-user-{{ message.id }}" class="prose prose-invert text-gray-200 max-w-none break-words"></div>
                <div id="user-message-controls-{{ message.id }}"></div>
            </div>
            <div class="w-8 h-8 bg-dark-light rounded-lg flex items-center justify-center flex-shrink-0">
                {% include "components/icons/user_avatar.html" %}
            </div>
        </div>
        {% elif message.role.value == 'assistant' %}
        {% include "chat/partials/ai_message.html" %}
        {% endif %}
    {% endfor %}
</div>